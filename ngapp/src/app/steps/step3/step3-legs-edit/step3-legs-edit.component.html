<app-header [step-index]="3"
            header_title="Define Legs"
            tooltip="In Pan/Zoom mode you can drag the map with left mouse button and zoom in/out with the scroll wheel. 
                     In Edit mode you can move constraint points with the left mouse button and create a new one with the middle button.
                     In the table on the right you can edit the points' x-valaue in function space and edit the function to use for that
                     leg's route.">
</app-header>
<app-map-edit
    panelWidth="450px"
    (drawOverlay)="drawOverlayTransformed($event)"
    (enumPoints)="enumPoints($event)"
    (movePointTo)="movePointTo($event)"
    (addPointAt)="addPointAt($event)" 
    (finalizePoints)="finalizeMove()"
>
    <h1>Leg</h1>
    <div fxLayout="row" fxLayoutAlign="center">
        <a mat-icon-button (click)="changeLeg(-1)" matTooltip="Previous leg" matTooltipShowDelay="500">
            <mat-icon aria-hidden="false" aria-label="Previous leg" fontIcon="arrow_left"></mat-icon>
        </a>
        <span>{{legs[leg_index]?legs[leg_index].name:''}} ({{leg_index+1}}/{{legs.length}})</span>
        <a mat-icon-button (click)="changeLeg(1)" matTooltip="Next leg" matTooltipShowDelay="500">
            <mat-icon aria-hidden="false" aria-label="Next leg" fontIcon="arrow_right"></mat-icon>
        </a>
    </div>
    <div>
        <app-math-edit (latexChange)="latexChange($event)"></app-math-edit>
    </div>
    <div>
        {{legs[leg_index]?legs[leg_index].function_range:''}}
    </div>
    <table>
        <thead class="table-header-cell">
            <td>X</td>
            <td>Lon/Lat</td>
            <td>Actions</td>
        </thead>            
        <tr *ngFor="let p of legs[leg_index]?legs[leg_index].points:[]; index as i">
            <td><input placeholder="functions x-value at this point" type="number" [value]="p.func_x | number:'1.2-2'" (change)="changeFuncX(i, $event)"></td>
            <td>{{p.lon | number:'1.2-2'}} {{p.lat | number:'1.2-2'}}</td>
            <td>
                <span class="row-buttons">
                    <span class="stacked-buttons">
                        <a (click)="moveConstraintPoint(i, true)" [className]="(i>1)&&(i<legs[leg_index].points.length-1)?'':'disabled-button'"
                           matTooltip="Move constraint point up" matTooltipShowDelay="500">
                            <mat-icon class="stacked-button" aria-hidden="false" aria-label="move up" fontIcon="arrow_drop_up"
                                fontSize="12"></mat-icon>
                        </a>
                        <a (click)="moveConstraintPoint(i, false)" [className]="(i<legs[leg_index].points.length-2)&&(i>0)?'':'disabled-button'"
                           matTooltip="Move constraint point down" matTooltipShowDelay="500">
                            <mat-icon class="stacked-button" aria-hidden="false" aria-label="move up" fontIcon="arrow_drop_down"
                                fontSize="12"></mat-icon>
                        </a>
                    </span>
                    <a (click)="deleteConstraintPoint(i)" matTooltip="Delete constraint point" matTooltipShowDelay="500">
                        <mat-icon class="button" aria-hidden="false" aria-label="delete" fontIcon="delete"></mat-icon>
                    </a>
                </span>
            </td>
        </tr>
    </table>
</app-map-edit>